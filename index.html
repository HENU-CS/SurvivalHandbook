<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation</title>
    <!-- 添加 markdown-it 用于解析 markdown -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/13.0.1/markdown-it.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <!-- 添加mermaid支持 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js"></script>
    <!-- 添加锁定样式 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- 添加代码高亮支持 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <!-- 自定义样式 -->
    <link rel="stylesheet" href="static/style.css">
    <!-- 添加网站图标 -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' fill='%23eef0f2'/%3E%3Ctext x='16' y='26' font-family='-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica Neue, Arial, sans-serif' font-size='26' font-weight='500' text-anchor='middle' fill='%23202122'%3EW%3C/text%3E%3C/svg%3E">
    <!-- 为 Safari 浏览器添加图标 -->
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' fill='%23eef0f2'/%3E%3Ctext x='16' y='26' font-family='-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica Neue, Arial, sans-serif' font-size='26' font-weight='500' text-anchor='middle' fill='%23202122'%3EW%3C/text%3E%3C/svg%3E">

    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <header class="header">
        <h1 class="header-title">河南大学生存/飞跃手册</h1>
        <div class="header-links">
            <a href="https://github.com/HENU-CS" class="header-link">[组织]</a>
            <a href="https://github.com/HENU-CS/SurvivalHandbook" class="header-link">[本仓库(欢迎贡献)]</a>
        </div>
    </header>

    <div class="container">
        <nav class="sidebar">


            <button class="sidebar-toggle" title="Move Blogs to right">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                    <line x1="12" y1="4" x2="12" y2="20"/>
                </svg>
            </button>


            <div class="nav-section">
                <div class="nav-items">
                    <a href="#" class="nav-link" data-md="S1_preface/01_intro.md">前言</a>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">
                    <span class="nav-toggle"></span>
                    生存手册
                </div>
                <div class="nav-items">
                    <a href="#" class="nav-link" data-md="S2_survival/01_basic_learning.md">基础学习</a>
                    <a href="#" class="nav-link" data-md="S2_survival/02_postgraduate_exam.md">关于考研</a>
                    <a href="#" class="nav-link" data-md="S2_survival/03_postgraduate_recommendation.md">关于保研</a>
                    <a href="#" class="nav-link" data-md="S2_survival/04_faq.md">常见问题</a>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">
                    <span class="nav-toggle"></span>
                    飞跃手册
                </div>
                <div class="nav-items">
                    <a href="#" class="nav-link" data-md="S3_leap/01_basic_learning.md">基础学习（成果分级榜单）</a>
                    <a href="#" class="nav-link" data-md="S3_leap/02_ms_internship_research.md">MS申请/找实习/搞科研</a>
                    <a href="#" class="nav-link" data-md="S3_leap/03_phd_application.md">PhD博士/Mphil/全奖MS申请</a>
                    <a href="#" class="nav-link" data-md="S3_leap/04_faq.md">常见问题</a>
                </div>
            </div>



        </nav>

        <!-- Add this HTML before your right sidebar -->
        <div class="right-sidebar-trigger"></div>

        <nav class="right-sidebar">
            <button class="right-lock-button">
                <i class="fas fa-lock"></i>
            </button>
            <!-- 内容将由 JavaScript 动态添加 -->
        </nav>

        <main class="main-content">
            <div class="markdown-body" id="content">
                <!-- Markdown 内容将被渲染在这里 -->
            </div>
        </main>
    </div>

    <script>
        // 初始化 markdown-it
        const md = window.markdownit({
            html: true,
            linkify: true,
            typographer: true,
            tables: true,
            highlight: function (str, lang) {
                if (lang === 'mermaid') {
                    return `<pre class="mermaid">${str}</pre>`;
                }
                if (lang && hljs.getLanguage(lang)) {
                    try {
                        return hljs.highlight(str, { language: lang }).value;
                    } catch (__) {}
                }
                return '';
            }
        });

        // 存储当前页面状态
        let currentPage = '';

        // 加载并渲染 Markdown 文件
        async function loadMarkdown(filename) {
            if (!filename) {
                console.error('No filename provided');
                document.getElementById('content').innerHTML = '<p>Error: Invalid page request</p>';
                return;
            }

            try {
                currentPage = filename;
                const response = await fetch(filename);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const text = await response.text();
                
                // 预处理数学公式 - 保存到占位符
                const mathExpressions = [];
                let counter = 0;
                
                // 替换块级公式
                let processedText = text.replace(/\$\$([\s\S]*?)\$\$/g, function(match, formula) {
                    const placeholder = `MATHBLOCK_${counter++}`;
                    mathExpressions.push({
                        placeholder: placeholder,
                        original: match,
                        formula: formula,
                        isBlock: true
                    });
                    return placeholder;
                });
                
                // 替换行内公式
                processedText = processedText.replace(/\$([\s\S]*?)\$/g, function(match, formula) {
                    const placeholder = `MATHINLINE_${counter++}`;
                    mathExpressions.push({
                        placeholder: placeholder,
                        original: match,
                        formula: formula,
                        isBlock: false
                    });
                    return placeholder;
                });
                
                // 渲染 Markdown
                let htmlContent = md.render(processedText);
                
                // 恢复数学公式
                mathExpressions.forEach(item => {
                    if (item.isBlock) {
                        htmlContent = htmlContent.replace(
                            item.placeholder, 
                            `$$${item.formula}$$`
                        );
                    } else {
                        htmlContent = htmlContent.replace(
                            item.placeholder, 
                            `$${item.formula}$`
                        );
                    }
                });
                
                // 更新DOM
                document.getElementById('content').innerHTML = htmlContent;
                
                // 初始化 Mermaid
                mermaid.init(undefined, document.querySelectorAll('.mermaid'));
                
                // 代码高亮
                document.querySelectorAll('pre code').forEach((block) => {
                    hljs.highlightBlock(block);
                });
                
                // 触发 MathJax 渲染
                if (window.MathJax && window.MathJax.typesetPromise) {
                    try {
                        await window.MathJax.typesetPromise();
                    } catch (e) {
                        console.error('MathJax rendering error:', e);
                    }
                }
                
                // 更新标题
                const firstH1 = document.querySelector('.markdown-body h1');
                if (firstH1) {
                    document.title = firstH1.textContent;
                }

                const newUrl = `${window.location.pathname}?page=${filename}`;
                history.pushState({ page: filename }, '', newUrl);
                
            } catch (error) {
                console.error('Error loading markdown file:', error);
                document.getElementById('content').innerHTML = 
                    `<p>Error loading content. Please make sure the file "${filename}" exists.</p>`;
            }
        }

        // 为所有具有data-md属性的链接添加点击事件
        document.addEventListener('DOMContentLoaded', () => {
            // 选择所有带有data-md属性的链接，包括导航栏和下拉菜单中的链接
            document.querySelectorAll('a[data-md]').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    const mdFile = e.currentTarget.getAttribute('data-md');
                    if (mdFile) {
                        loadMarkdown(mdFile);
                    }
                });
            });
        });

        // 添加折叠功能
        document.querySelectorAll('.nav-section-title').forEach(title => {
            title.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                const section = title.closest('.nav-section');
                section.classList.toggle('collapsed');
            });
        });

        // 初始化页面
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const page = urlParams.get('page') || 'S1_preface/01_intro.md'; // 设置默认页面
            loadMarkdown(page);
        });

        // 处理浏览器前进/后退
        window.addEventListener('popstate', (e) => {
            if (e.state && e.state.page) {
                loadMarkdown(e.state.page);
            } else {
                const urlParams = new URLSearchParams(window.location.search);
                const page = urlParams.get('page') || 'S1_preface/01_intro.md';
                loadMarkdown(page);
            }
        });
</script>

<!--以下是右侧目录栏的script-->

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const toggleButton = document.querySelector('.sidebar-toggle');
        const rightSidebar = document.querySelector('.right-sidebar');
        const mainContent = document.querySelector('.main-content');
        const blogsSection = document.querySelector('#blogs-section');
        let isRightSidebarActive = false;

        toggleButton.addEventListener('click', () => {
            isRightSidebarActive = !isRightSidebarActive;
            
            if (isRightSidebarActive) {
                // 完全清空右侧栏
                rightSidebar.innerHTML = '';
                
                // 添加锁定按钮
                const lockButton = document.createElement('button');
                lockButton.className = 'right-lock-button';
                lockButton.innerHTML = '<i class="fas fa-lock"></i>';
                rightSidebar.appendChild(lockButton);

                // 添加博客内容
                const clonedBlogsSection = blogsSection.cloneNode(true);
                rightSidebar.appendChild(clonedBlogsSection);
                blogsSection.style.display = 'none';
                rightSidebar.classList.add('active');
                mainContent.classList.add('shifted');
                
                // 为克隆的元素重新绑定事件
                clonedBlogsSection.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        const mdFile = e.currentTarget.getAttribute('data-md');
                        if (mdFile) {
                            loadMarkdown(mdFile);
                        }
                    });
                });

                clonedBlogsSection.querySelectorAll('.nav-section-title').forEach(title => {
                    title.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        const section = title.closest('.nav-section');
                        section.classList.toggle('collapsed');
                    });
                });

                // 重新绑定锁定按钮事件
                lockButton.addEventListener('click', function() {
                    const icon = this.querySelector('i');
                    if (icon.classList.contains('fa-lock-open')) {
                        icon.classList.remove('fa-lock-open');
                        icon.classList.add('fa-lock');
                        rightSidebar.classList.add('locked');
                    } else {
                        icon.classList.remove('fa-lock');
                        icon.classList.add('fa-lock-open');
                        rightSidebar.classList.remove('locked');
                        rightSidebar.classList.remove('active');
                    }
                });
            } else {
                // 移动回左侧时完全清空右侧栏
                rightSidebar.innerHTML = '';
                blogsSection.style.display = 'block';
                rightSidebar.classList.remove('active');
                mainContent.classList.remove('shifted');
            }
        });
    });
</script>


<!-- 右侧目录是消失、悬停和锁定 -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const rightSidebar = document.querySelector('.right-sidebar');
        const rightLockButton = document.querySelector('.right-lock-button');
        const rightSidebarTrigger = document.querySelector('.right-sidebar-trigger');
        
        // Function to check content and update visibility
        const updateSidebarVisibility = () => {
            const hasContent = rightSidebar.children.length > 1;
            if (!hasContent) {
                rightSidebarTrigger.style.display = 'none';
                rightSidebar.style.display = 'none';
                rightSidebar.classList.remove('locked', 'active');
                const icon = rightLockButton.querySelector('i');
                icon.classList.remove('fa-lock-open');
                icon.classList.add('fa-lock');
            } else {
                rightSidebarTrigger.style.display = '';
                rightSidebar.style.display = '';
                // 确保初始状态为锁定
                rightSidebar.classList.add('locked');
                const icon = rightLockButton.querySelector('i');
                icon.classList.remove('fa-lock-open');
                icon.classList.add('fa-lock');
            }
        };
        
        // Add lock functionality
        rightLockButton.addEventListener('click', function() {
            if (rightSidebar.children.length <= 1) {
                return; // Ignore lock clicks when there's no content
            }
            
            const icon = this.querySelector('i');
            if (icon.classList.contains('fa-lock-open')) {
                icon.classList.remove('fa-lock-open');
                icon.classList.add('fa-lock');
                rightSidebar.classList.add('locked');
            } else {
                icon.classList.remove('fa-lock');
                icon.classList.add('fa-lock-open');
                rightSidebar.classList.remove('locked');
                rightSidebar.classList.remove('active');
            }
        });

        // Initial visibility check and set locked state
        updateSidebarVisibility();

        // Only show initial animation if sidebar has content
        setTimeout(() => {
            const hasContent = rightSidebar.children.length > 1;
            if (hasContent) {
                rightSidebar.classList.add('active');
                // 确保初始动画后保持锁定状态
                rightSidebar.classList.add('locked');
            }
        }, 100);

        // Add observer to monitor content changes
        const observer = new MutationObserver(updateSidebarVisibility);
        observer.observe(rightSidebar, { childList: true });
    });
</script>

<footer>
    <div class="footer-text">
        © CC BY-SA 4.0: Feel free to use this template, but please keep the Powered by <a href="https://github.com/World-Snapshot/doc" target="_blank">World Snapshot Doc</a>.
    </div>
</footer>

</body>
</html>